[**正则表达式管道guideline.md**](https://gist.github.com/No3371/f1750b178376f0659df6650ccaf57c12#file-regex-pipeline-guideline-md)

# [](https://gist.github.com/No3371/f1750b178376f0659df6650ccaf57c12#regex-rulesets-pipeline-usage)正则表达式规则集管道使用

Regex Pipeline 是一个[Obsidian](https://obsidian.md/)插件，它允许用户设置自定义正则表达式规则以编程方式重新格式化笔记。这在构建个人知识数据库时特别有用，因为您经常剪辑需要类似重新格式化以匹配您的风格的网页。

## [](https://gist.github.com/No3371/f1750b178376f0659df6650ccaf57c12#usage)用法

### [](https://gist.github.com/No3371/f1750b178376f0659df6650ccaf57c12#first-of-all)首先

当您启用插件时，一个名为的文件`index.txt`会在您的 Vault 中创建，位于`.obsidian/regex-rulesets/`. 它是空的，等待您的第一个规则集。由于 Obsidian 如何保护您的磁盘，我们需要一个索引文件来指定 Regex Pipeline 呈现的规则集。

启用 Regex Pipeline 后，在选项中，您可能需要分配键盘快捷键。

从版本 1.0.8 开始，Regex Pipeline 提供了一个用于添加新规则集的弹出窗口。单击`+`加号按钮，然后填写规则集名称和规则。但是，以后要修改规则或删除规则集，您仍然必须`.obsidian/regex-rulesets/`使用标准编辑器（Notepad++、VSCode、Atom、Sublime、VIM 等）进行编辑。

标准编辑器做得很好，Regex 规则集管道很难提供像他们一样安全、流畅和全面的编辑体验。对于复杂的正则表达式字符串，您可能会在将其放入规则集之前使用您的编辑器进行制作、测试和确认。

### [](https://gist.github.com/No3371/f1750b178376f0659df6650ccaf57c12#to-run-a-ruleset)运行规则集

-   在编辑器模式下查看注释，选择文本作为重新格式化的目标。**注意 BENE：**如果选择了任何文本，则该文本和该文本仅是搜索的目标。**不**选择文本与选择**所有**文本相同。
-   通过单击侧栏中的图标，或从命令面板中选择，或使用键盘快捷键来调出正则表达式规则集管道重新格式化弹出窗口（有关更多信息，请参阅应用规则集）。
-   选择并运行规则集。
    -   要运行规则集，请单击其按钮。
        -   **小心！**选择它时会立即执行重新格式化。
    -   要创建新规则集，请单击`+`规则集菜单中的（加号）按钮。
        -   给它一个名字
        -   在双引号内输入搜索字符串（正则表达式）
        -   输入`->`（破折号大于）
        -   在双引号内输入 REPLACE 字符串（正则表达式）
        -   点击`Done`
    -   完成添加新规则后，单击其按钮运行它
    -   成功或失败的祝酒词将在屏幕右上方闪烁
-   要删除或修改规则集，请使用文本编辑器，前往`.obsidian/regex-rulesets/`并删除或编辑规则集文件，然后删除/添加/更改`index.txt`.

### [](https://gist.github.com/No3371/f1750b178376f0659df6650ccaf57c12#writing-rulesets)编写规则集

-   您必须在添加新规则集时在弹出窗口中编辑您自己的规则集，或者稍后使用 Notepad++、Atom、VSCode 等文本编辑器直接编辑文件。
-   每个规则都提供一个正则表达式匹配字符串以及一组可选的正则表达式标志（请参阅下面的正则表达式标志）
-   匹配字符串后跟一个由破折号和大于组成的箭头
-   正则表达式替换字符串使用`$`（美元符号）加数字（1-9）来表示捕获组
-   正则表达式替换字符串后面可以跟可选的自定义标志`x`，指示零长度字符串（见下文将搜索命中替换为空）
-   一个规则集包含一个或多个规则，每行一个规则，每个规则如下所示：

```
"SEARCH"->"REPLACE"
:: comments are okay on separate lines marked by double-colon
```

#### [](https://gist.github.com/No3371/f1750b178376f0659df6650ccaf57c12#multi-line-rule-okay)多行规则没问题：

“搜索 1”->“替换 1” “SEARCH2”->“REPL ACE2" :: SEARCH2 命中替换为 REPL +回车（不可见 ` \r \n ` ） + ACE2

#### [](https://gist.github.com/No3371/f1750b178376f0659df6650ccaf57c12#regex-flags)正则表达式标志

默认情况下，双正则表达式标志`gm`附加到正则表达式 **搜索**项。标志 'g' 表示全局，替换超过 1 次命中。标志`m`意味着多行，锚标记`^`（开始）和`$`（结束）将应用于每一行，而不是整个字符串。

`gm`标志通常是必需的。您很少希望只替换 1 个匹配项，或者像选择仅 1 行一样操作。

您可以通过提供自己的标志来覆盖默认值，包括`i`不区分大小写、`y`粘性、`u`Unicode；例如，`gmu`在 SEARCH 项之后立即使用一个标志，如下所示：

```
"SEARCH"gmu->"REPLACE"
:: with Unicode support flagged
```

#### [](https://gist.github.com/No3371/f1750b178376f0659df6650ccaf57c12#replacing-search-hits-with-nothing)用空替换搜索命中

由于插件解析规则的工作方式，替换项 (REPLACE) 不能是零长度字符串。如果要删除每个 SEARCH 命中（即替换为“”），`x`请在 REPLACE 项后添加此自定义标志：

```
"SEARCH"->"REPLACEtext here does not matter"x
:: "SEARCH" hits will become "", zero-length, no matter what's in REPLACE string
```

注意Bene：REPLACE里面一定有_东西_，但是不管是什么，插件都会把它当成“”。

### [](https://gist.github.com/No3371/f1750b178376f0659df6650ccaf57c12#indexing-rulesets)索引规则集

规则集必须保存在`.obsidian/regex-rulesets/`. 文件名（没有文件类型扩展名）必须列在`index.txt`文件中，每行一个规则集名称。规则集名称必须与其文件名完全匹配。对于选择，规则集以按钮的形式呈现给您，按`index.txt`.

您可以将 Regex 规则集管道绑定到其选项中的键盘快捷键。

## [](https://gist.github.com/No3371/f1750b178376f0659df6650ccaf57c12#example-rulesets)示例规则集

-   **NumberToAlphabet**这个规则集有 9 条规则将数字 1 到 9 转换为字母。

`.obsidian/regex-rulesets/number-to-alphabet.txt`

“1”->“A” “2”->“B” “3”->“C” “4”->“D” “5”->“E” “6”->“F” “7”->“G” “8”->“H” “9”->“我”

-   **Table_C2**此规则集将_选定的内容_转换为 2 列的表格！每对非空行将形成一行，每列一行。

`.obsidian/regex-rulesets/Table_C2.txt`

" ^ ( . + ) $ \n \n ^ ( . + ) $ "->" |  $ 1 |  $ 2 | "  :: 匹配并捕获成对的两条连续行，将每对放在一行两个单元格中

## [](https://gist.github.com/No3371/f1750b178376f0659df6650ccaf57c12#recommendations)建议

-   _**有关更多示例**_，请查看[示例文件夹](https://github.com/No3371/obsidian-regex-pipeline/tree/master/samples)，其中包括一个非常复杂的示例，如上面的 gif！
-   有关有用的指导和实验，请查看[REGEX101](https://regex101.com/)
-   浏览器扩展 Markdownload ( [https://github.com/deathau/markdownload](https://github.com/deathau/markdownload) )：对于剪辑网页，不要忘记配置它以匹配您的编辑偏好。